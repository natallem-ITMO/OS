#!/bin/bash

#Процесс «Генератор» считывает с консоли строки в бесконечном цикле. Если считанная строка содержит единственный символ «+», он посылает процессу «Обработчик» сигнал USR1. Если строка содержит единственный символ «*», генератор посылает обработчику сигнал USR2. Если строка содержит слово TERM, генератор посылает обработчику сигнал SIGTERM. Другие значения входных строк игнорируются. Обработчик добавляет 2 или умножает на 2 текущее значение обрабатываемого числа (начальное значение принять на единицу) в зависимости от полученного пользовательского сигнала и выводит результат на экран. Вычисление и вывод производятся один раз в секунду. Получив сигнал SIGTERM,«Обработчик» завершает свою работу, выведя сообщения о завершении работы по сигналу от другого процесса.

echo $$ > .pid
val=1
MODE="NONE"

usr1()
{
MODE="+"
}

usr2()
{
MODE="*"
}

sigterm_func()
{
MODE="DONE"
}

trap 'sigterm_func' SIGTERM
trap 'usr1' USR1
trap 'usr2' USR2

while true; do
	case "$MODE" in
		"NONE")
			:
		;;
		\*)
			let val=$val\*2;
		;;
		\+)
			let val=$val\+2;
		;;
		"DONE")
			echo "Stopped by SIGTERM num=$val"
			exit
		;;
	esac
	sleep 1
done
